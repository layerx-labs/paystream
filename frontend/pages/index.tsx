import type { NextPage } from "next";
import Head from "next/head";
import styles from "../styles/Home.module.css";
import { GridContainer, GridCol, GridRow, Button } from "@taikai/rocket-kit";
import useBalance from "../hooks/useETHBalance";
import { useWeb3 } from "../hooks/useWeb3";
import { dappConfig } from "../config";
import useAddress from "../hooks/useAddress";
import { useOwnerQuery } from "../hooks/sablier/queries";
import useERC20TokenAllowance from "../hooks/useERC20TokenAllowance";

const ShowWalletDetails = ()=> {  
  const { chainId  }  = useWeb3();
  const { address= "" }  = useAddress();  
  const { balance } = useBalance();
  const { owner } = useOwnerQuery(dappConfig.sablierContracAddress);
  const { allowed } = useERC20TokenAllowance(dappConfig.beproContracAddress, address ? address: "", dappConfig.sablierContracAddress);
  return (
    <>
      <GridRow>
        <GridCol>{chainId}</GridCol>
      </GridRow>
      <GridRow>
        <GridCol>{address}</GridCol>
      </GridRow>
      <GridRow>
        <GridCol>{balance} ETH</GridCol>
      </GridRow>
      <GridRow>
        <GridCol>{owner} is the Owner</GridCol>
      </GridRow>
      <GridRow>
        <GridCol>{allowed} to be spent</GridCol>
      </GridRow>
      <GridRow>
        <GridCol>
          123
        </GridCol>
      </GridRow>
    </>
  );
};

const Home: NextPage = () => { 
  const {connected, connect, disconnect, error } = useWeb3();

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <GridContainer className={styles.main}>
        <GridRow>
          <GridCol>PayStream App</GridCol>
        </GridRow>
        <GridRow>
          <GridCol>
            {!connected && (
              <Button
                ariaLabel="Connect Wallet"
                className="button"
                color="green"
                querySelector=".button"
                value="Connect Wallet"
                variant="solid"
                action={()=> connect()}
              />
            )}
          </GridCol>
        </GridRow>
        {connected && <ShowWalletDetails />}         
        {connected && (
          <GridRow>
            <GridCol>
              <Button
                ariaLabel="Disconnect Wallet"
                className="button"
                color="green"
                querySelector=".button"
                value="Disconnect Wallet"
                variant="solid"
                action={() => {
                  disconnect();
                }}
              />
            </GridCol>
          </GridRow>
        )}
        {error && (
          <GridRow>
            <GridCol>
              <>Error: {error}</>
            </GridCol>
          </GridRow>
        )}       
      </GridContainer>
    </div>
  );
};

export default Home;
