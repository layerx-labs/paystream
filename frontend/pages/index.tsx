import type { NextPage } from "next";
import Head from "next/head";
import styles from "../styles/Home.module.css";
import { GridContainer, GridCol, GridRow, Button } from "@taikai/rocket-kit";
import { useContext } from "react";
import { WebConnectionCtx } from "../context";
import { Web3Connection } from "@taikai/dappkit";
import { useBalance } from "../hooks/useBalance";
import { useAddress } from "../hooks/useAddress";
import { useERC20Balance } from "../hooks/useERC20Balance";
import { useWeb3 } from "../hooks/useWeb3";
import { ChainId } from "../constants/networks";
import { dappConfig } from "../config";


interface ShowWalletDetailsProps  {
  connection: Web3Connection;
}

const ShowWalletDetails = ( props: ShowWalletDetailsProps)=> {
  const { balance } = useBalance(props.connection);
  const { address } = useAddress(props.connection);
  const { balance: beproBalance } = useERC20Balance(
    props.connection, 
    dappConfig.beproContracAddress, 
    address
  );
  return <>
      <GridRow>
        <GridCol>{address}</GridCol>
      </GridRow>
      <GridRow>
        <GridCol>{balance} ETH</GridCol>
      </GridRow>
      <GridRow>
        <GridCol>{beproBalance} BEPRO</GridCol>
      </GridRow>
    </>
};

const Home: NextPage = () => { 
  const web3Con: Web3Connection = useContext(WebConnectionCtx);
  const {connected, connecting, connect , error, disconnect }  = useWeb3(web3Con);

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <GridContainer className={styles.main}>
        <GridRow>
          <GridCol>PayStream App</GridCol>
        </GridRow>
        <GridRow>
          <GridCol>
            {!connected && (
              <Button
                ariaLabel="Connect Wallet"
                className="button"
                color="green"
                querySelector=".button"
                value="Connect Wallet"
                variant="solid"
                action={()=> connect()}
              />
            )}
          </GridCol>
        </GridRow>
        {connected && <ShowWalletDetails connection={web3Con} />}         
        {connected && (
          <GridRow>
            <GridCol>
              <Button
                ariaLabel="Disconnect Wallet"
                className="button"
                color="green"
                querySelector=".button"
                value="Disconnect Wallet"
                variant="solid"
                action={() => {
                  disconnect();
                }}
              />
            </GridCol>
          </GridRow>
        )}
        {error && (
          <GridRow>
            <GridCol>
              <>Error: {error}</>
            </GridCol>
          </GridRow>
        )}
        {connecting && (
          <GridRow>
            <GridCol>
              <>Connecting...</>
            </GridCol>
          </GridRow>
        )}
      </GridContainer>
    </div>
  );
};

export default Home;
